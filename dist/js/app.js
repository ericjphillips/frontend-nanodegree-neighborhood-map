function initMap(){"use strict";map=new google.maps.Map(document.getElementById("map"),{center:viewModel.center,zoom:8}),viewModel.infowindow=new google.maps.InfoWindow({content:"",pixelOffset:new google.maps.Size(0,-30)})}function googleError(){"use strict";window.alert("Google Maps could not be reached.")}function slide(){"use strict";sidebar.classList.toggle("slide"),chevron.classList.toggle("spin")}var $,google,map,ko,viewModel={center:{lat:43.9753,lng:-72.5623},brewery:ko.observableArray([]),filterby:ko.observable(""),open2Public:ko.observable(!1),keywords:ko.observable(""),infowindow:{}};viewModel.infoWindowChange=function(a){"use strict";viewModel.infowindow.close(),viewModel.infowindow.setOptions({content:'Loading: <i class="fa fa-beer fa-spin"></i>',position:a.marker.position}),viewModel.infowindow.open(map),a.marker.setAnimation(google.maps.Animation.BOUNCE),$.getJSON("/untappd/search?q="+a.brewery.name,function(b){if(void 0!==b.response.brewery.items[0])$.getJSON("/untappd/brewery?brewery_id="+b.response.brewery.items[0].brewery.brewery_id,function(b){var c,d="";a.untappd=b.response.brewery,d+='<img src="'+a.untappd.brewery_label+'">',d+="<h1>"+a.untappd.brewery_name+"</h1>",a.hasOwnProperty("established")&&(d+="<p> est. "+a.established+"</p>"),a.untappd.hasOwnProperty("brewery_description")&&(d+="<p>"+a.untappd.brewery_description+"</p>"),d+="<p>",a.untappd.contact.url.length>0&&(d+='<a href="'+a.untappd.contact.url+'" target="_blank">'+a.untappd.contact.url+"</a> "),a.untappd.contact.facebook.length>0&&(d+='<a href="'+a.untappd.contact.facebook+'" target="_blank"><i class="fa fa-facebook-official"></i></a> '),a.untappd.contact.instagram.length>0&&(d+='<a href="https://www.instagram.com/'+a.untappd.contact.instagram+'" target="_blank"><i class="fa fa-instagram"></i></a> '),a.untappd.contact.twitter.length>0&&(d+='<a href="https://twitter.com/'+a.untappd.contact.twitter+'" target="_blank"><i class="fa fa-twitter"></i></a>'),a.untappd.beer_list.items.length>0&&(d+="</p>",d+="<p>Beer enthusiasts on Untappd really like the ",c=a.untappd.beer_list.items.reduce(function(a,b){return a.beer.rating_score>b.beer.rating_score?a:b}),d+='<a href="https://untappd.com/beer/'+c.beer.bid+'" target="_blank">'+c.beer.beer_name+"</a>"),viewModel.infowindow.setOptions({content:d,position:a.marker.position}),viewModel.infowindow.open(map),a.marker.setAnimation(null)});else{var c="";c+="<h1>"+a.brewery.name+"</h1>",a.hasOwnProperty("established")&&(c+="<p> est. "+a.established+"</p>"),a.hasOwnProperty("website")&&(c+='<p><a href="'+a.website+'">'+a.website+"</a></p>"),a.hasOwnProperty("description")&&(c+="<p>"+a.description+"</p>"),viewModel.infowindow.setOptions({content:c}),a.marker.setAnimation(null)}})},ko.utils.stringContains=function(a,b){"use strict";return a=a||"",b.length>a.length?!1:a.indexOf(b)>-1},viewModel.listView=ko.computed(function(){"use strict";var a=viewModel.open2Public(),b=viewModel.keywords().toLowerCase(),c=viewModel.filterby();if(!b&&!a)return viewModel.brewery().forEach(function(a){a.marker.setVisible(!0)}),viewModel.brewery();if(!b&&a)return ko.utils.arrayFilter(viewModel.brewery(),function(a){return"Y"===a.openToPublic?(a.marker.setVisible(!0),!0):(a.marker.setVisible(!1),!1)});switch(c){case"Name":return a?ko.utils.arrayFilter(viewModel.brewery(),function(a){return ko.utils.stringContains(a.brewery.name.toLowerCase(),b)&&"Y"===a.openToPublic?(a.marker.setVisible(!0),!0):(a.marker.setVisible(!1),!1)}):ko.utils.arrayFilter(viewModel.brewery(),function(a){return ko.utils.stringContains(a.brewery.name.toLowerCase(),b)?(a.marker.setVisible(!0),!0):(a.marker.setVisible(!1),!1)});case"Location":return a?ko.utils.arrayFilter(viewModel.brewery(),function(a){return ko.utils.stringContains(a.locality.toLowerCase(),b)&&"Y"===a.openToPublic?(a.marker.setVisible(!0),!0):(a.marker.setVisible(!1),!1)}):ko.utils.arrayFilter(viewModel.brewery(),function(a){return ko.utils.stringContains(a.locality.toLowerCase(),b)?(a.marker.setVisible(!0),!0):(a.marker.setVisible(!1),!1)})}}),$.ajax({type:"GET",dataType:"json",url:"/brewDB/",success:function(a){"use strict";a.data.forEach(function(b){var c=b;c.marker=new google.maps.Marker({position:{lat:c.latitude,lng:c.longitude},map:map,title:c.brewery.name}),c.marker.addListener("click",function(){viewModel.infoWindowChange(c)}),viewModel.brewery.push(c),a.data.indexOf(b)===a.data.length-1&&viewModel.brewery.sort(function(a,b){return a.brewery.name===b.brewery.name?0:a.brewery.name<b.brewery.name?-1:1})})},error:function(){"use strict";window.alert("Oh no. No brewery data available. Please check your connection.")}}),ko.applyBindings(viewModel);var chevron=document.getElementById("chevron"),sidebar=document.getElementById("sidebar");chevron.addEventListener("click",slide);